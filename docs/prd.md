# FlowPaste (妙贴) 产品需求文档 (PRD)

| 项目 | 内容 |
| :--- | :--- |
| **产品名称** | FlowPaste (妙贴) |
| **版本号** | v1.0 (MVP) |
| **Slogan** | 剪贴即意图，心流不打断 (Paste at the speed of thought) |
| **核心定位** | 隐私优先、AI 驱动的智能剪贴板增强工具 |
| **文档日期** | 2025-12-18 |

---

## 1. 项目背景与目标 (Background & Goals)

### 1.1 背景
在日常办公、编程和写作中，用户频繁在不同应用间复制粘贴文本。由于源格式与目标格式不兼容（如 PDF 到 Word 的换行问题、JSON 乱码、代码缩进错误），用户不得不手动进行繁琐的格式调整。现有的工具要么过于技术化（正则脚本），要么缺乏智能（只能纯文本粘贴）。

### 1.2 目标
开发一款轻量级桌面工具，拦截用户的粘贴行为，通过 **规则引擎** 和 **AI 模型** 自动分析并处理文本格式，同时通过 **本地脱敏技术** 消除用户对云端 AI 处理敏感数据的隐私顾虑。

### 1.3 核心价值
1.  **Flow (心流):** 减少格式调整时间，保持工作专注。
2.  **Privacy (隐私):** 敏感数据不出本地，脱敏后处理。
3.  **Speed (极速):** 本地优先策略，毫秒级响应。

---

## 2. 用户画像 (User Personas)

*   **开发者 (Dev):** 需要格式化 JSON/XML，转换代码语言，提取 Log 关键信息。
*   **内容创作者 (Creator):** 需要 Markdown 与纯文本互转，润色社交媒体文案。
*   **商务人士 (Business):** 需要翻译邮件，整理会议记录，清洗 Excel 数据。

---

## 3. 功能需求 (Functional Requirements)

### 3.1 核心剪贴板交互
| ID | 功能模块 | 需求描述 | 优先级 |
| :--- | :--- | :--- | :--- |
| **F-01** | 全局激活 | 支持自定义快捷键（默认 `Cmd/Ctrl + Shift + V`）唤起悬浮面板。 | P0 |
| **F-02** | 剪贴板读取 | 唤起时自动读取系统剪贴板当前的文本内容。 | P0 |
| **F-03** | 结果上屏 | 用户确认后，模拟键盘输入或调用系统 API 将处理后的文本粘贴到光标处。 | P0 |
| **F-04** | 原始粘贴 | 提供“不做任何处理直接粘贴”的兜底选项。 | P0 |

### 3.2 智能处理引擎 (The Brain)
| ID | 功能模块 | 需求描述 | 优先级 |
| :--- | :--- | :--- | :--- |
| **F-05** | 本地正则规则 (L1) | 内置常见规则：去空行、去空格、中英文加空格、转纯文本。此过程不联网。 | P0 |
| **F-06** | 意图识别 (L2) | AI 自动分析文本类型（代码/JSON/表格/乱序文本），并生成 1-3 个推荐操作（Action Chips）。 | P1 |
| **F-07** | 自然语言指令 | 允许用户输入指令（如：“翻译成日文”、“转成 CSV”），调用 LLM 处理。 | P1 |
| **F-08** | 本地模型支持 | 支持连接本地 Ollama (Base URL 设置)，调用 Llama3/Qwen 等模型。 | P1 |
| **F-09** | 云端模型支持 | 支持 OpenAI 格式的 API (DeepSeek, GPT-4, Claude)，允许用户填写 Base URL 和 Key。 | P0 |

### 3.3 隐私安全盾 (Privacy Shield)
| ID | 功能模块 | 需求描述 | 优先级 |
| :--- | :--- | :--- | :--- |
| **F-10** | 敏感信息识别 | 在发送请求前，本地正则扫描：手机号、邮箱、身份证、银行卡、IP、常见的 Key (sk-...)。 | P0 |
| **F-11** | 脱敏与回填 | 识别到的信息替换为 `{{TYPE_ID}}` 占位符；AI 返回结果后，本地将占位符还原为原始内容。 | P0 |
| **F-12** | 安全状态提示 | UI 需明确标识当前操作是否联网，是否有敏感信息被过滤。 | P1 |

---

## 4. UI 与交互设计 (UI & Interaction Design)

这是 FlowPaste 区别于竞品的关键，设计原则是：**隐形、克制、键盘优先**。

### 4.1 界面形态 (Visual Form)
*   **Spotlight 风格:** 界面为一个居中或跟随鼠标的**极简搜索栏**，没有任何多余的边框和菜单栏。
*   **尺寸:** 宽度约 600px，高度根据内容自适应。
*   **配色:** 跟随系统深色/浅色模式。

### 4.2 交互状态机 (Interaction States)

#### 状态 A: 唤起与预览 (Invoke & Preview)
*   **触发:** 用户按下 `Cmd + Shift + V`。
*   **界面显示:**
    *   **顶部:** 输入框，光标闪烁，placeholder 显示 "Describe format or choose below..."。
    *   **中部 (Preview):** 显示剪贴板原文的前 3 行预览（灰色字体）。
    *   **下部 (Recommendations):** 显示 3 个 AI 预判的胶囊按钮（可通过快捷键 `1`, `2`, `3` 触发）。
        *   *例如:* `[1. Format JSON]` `[2. Minify]` `[3. To TypeScript Interface]`
    *   **状态栏:** 右下角显示一个小盾牌图标 🛡️。如果是绿色，Hover 显示“隐私盾已激活：3个敏感词已脱敏”。

#### 状态 B: 处理中 (Processing)
*   **触发:** 用户按下了 `1` 或者输入了指令并回车。
*   **界面显示:**
    *   输入框变为“处理中...”状态。
    *   **Skeleton/Streaming:** 结果区域开始流式输出（打字机效果）。
    *   **关键点:** 如果是本地正则处理（如去空行），此状态应少于 10ms，肉眼不可见。

#### 状态 C: 结果确认与微调 (Result & Refine)
*   **触发:** AI 处理完毕。
*   **界面显示:**
    *   展示处理后的文本预览（支持代码高亮）。
    *   **Diff 视图 (可选):** 如果改动涉及数字，高亮显示变动部分，防止 AI 幻觉篡改数据。
*   **操作:**
    *   `Enter`: 确认上屏（窗口消失）。
    *   `Esc`: 放弃修改，返回上一级或关闭。
    *   `Tab`: 编辑 AI 的结果。

### 4.3 关键交互细节
1.  **键盘流 (Keyboard Flow):** 用户不需要碰鼠标。`Cmd+Shift+V` -> `1` -> (自动上屏) 应当一气呵成。
2.  **乐观上屏 (Optimistic Paste):** 对于确定性极高的操作（如“转纯文本”），点击选项后无需等待预览，直接上屏并关闭窗口。
3.  **错误反馈:** 如果 API 报错，窗口抖动并显示红色错误信息，但不阻断用户操作，用户仍可按 `Esc` 关闭。

---

## 5. 技术架构与性能 (Technical Architecture)

### 5.1 技术栈
*   **Core:** Rust (Tauri Backend) - 负责系统 API 调用、本地正则引擎、HTTP 请求、加密存储。
*   **UI:** React/Vue + TailwindCSS - 负责界面渲染。
*   **Local DB:** SQLite - 存储用户配置、自定义 Prompt、无需云端同步的使用记录。

### 5.2 性能指标 (SLA)
*   **唤起速度:** < 100ms (从按下快捷键到窗口完全渲染)。
*   **内存占用:** 静默状态下 < 50MB。
*   **本地处理延迟:** < 50ms。
*   **AI 响应:** 流式输出首字延迟 < 1s (取决于网络/本地模型速度)。

---

## 6. 数据隐私与安全说明 (Privacy & Security)

### 6.1 脱敏流程示例
用户复制文本：`联系人：张三，手机：13800138000`

1.  **Regex Match:** 匹配到 `13800138000` (Pattern: Mobile CN)。
2.  **Map Storage:** 在内存中生成映射表 `{'{{PHONE_01}}': '13800138000'}`。
3.  **Prompt Assembly:** 组装 Prompt 给 AI：`请把以下文本转为 JSON: 联系人：张三，手机：{{PHONE_01}}`。
4.  **AI Response:** `{"name": "张三", "phone": "{{PHONE_01}}"}`。
5.  **Rehydration:** 客户端收到响应，查找映射表，将 `{{PHONE_01}}` 替换回 `13800138000`。
6.  **Paste:** 最终结果上屏。

### 6.2 密钥存储
*   用户的 API Key (OpenAI/DeepSeek) 必须使用系统级安全存储 (Windows Credential Locker / macOS Keychain) 进行加密存储，严禁明文存入数据库或配置文件。

---

## 7. 路线图 (Roadmap)

### Phase 1: MVP (Month 1)
*   完成 Tauri 框架搭建。
*   实现基础剪贴板读取与模拟粘贴。
*   实现 UI 骨架。
*   集成 OpenAI 兼容接口。
*   内置 5 个基础正则规则（去空行、纯文本等）。

### Phase 2: Privacy & Local (Month 2)
*   **上线隐私盾功能 (PII 脱敏)。**
*   集成 Ollama 本地 API 检测与调用。
*   优化流式输出体验。

### Phase 3: FlowPaste Cloud (Month 3)
*   推出 Pro 会员体系。
*   上线自研微调小模型 API (Hosted Qwen-1.5B/3B)。
*   支持自定义 Prompt 市场。

---

## 8. 附录：埋点与数据统计
*   **不采集内容:** 严禁采集用户复制的具体文本内容。
*   **采集行为:**
    *   功能使用频次 (如：有多少人用了“JSON格式化”)。
    *   API 响应时间。
    *   错误率统计。